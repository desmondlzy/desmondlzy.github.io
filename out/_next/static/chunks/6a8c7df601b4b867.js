(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31713,e=>{"use strict";var t=e.i(86143),l=e.i(22828),r=e.i(36299),s=e.i(54053);function a(e,t){return Array.from({length:t},()=>Array(e).fill(0))}function o(e,t){let l=new Set,r=[],s=e.length,o=e[0].length,i=[{r:-1,c:0},{r:1,c:0},{r:0,c:-1},{r:0,c:1}];for(let n=0;n<s;n++)for(let d=0;d<o;d++)if(0!==e[n][d]&&!l.has(`${n},${d}`)){let c={minR:n,maxR:n,minC:d,maxC:d,points:[]},p=[{x:d,y:n}];for(l.add(`${n},${d}`),c.points.push({x:d,y:n});p.length>0;){let t=p.shift();for(let r of i){let a=t.y+r.r,i=t.x+r.c;a>=0&&a<s&&i>=0&&i<o&&0!==e[a][i]&&!l.has(`${a},${i}`)&&(l.add(`${a},${i}`),p.push({x:i,y:a}),c.points.push({x:i,y:a}),a<c.minR&&(c.minR=a),a>c.maxR&&(c.maxR=a),i<c.minC&&(c.minC=i),i>c.maxC&&(c.maxC=i))}}let x=c.maxR-c.minR+1,h=a(c.maxC-c.minC+1,x);for(let e of c.points)h[e.y-c.minR][e.x-c.minC]=1;r.push({shape:h,position:{x:t.x+c.minC,y:t.y+c.minR}})}return r}function i(e,t){let l=e.position.x+e.shape[0].length,r=e.position.y+e.shape.length,s=t.position.x+t.shape[0].length,a=t.position.y+t.shape.length;if(e.position.x>=s||t.position.x>=l||e.position.y>=a||t.position.y>=r)return!1;let o=Math.max(e.position.x,t.position.x),i=Math.min(l,s),d=Math.max(e.position.y,t.position.y),c=Math.min(r,a);for(let l=d;l<c;l++)for(let r=o;r<i;r++){let s=n(e,r,l),a=n(t,r,l);if(s&&a)return!0}return!1}function n(e,t,l){let r=t-e.position.x,s=l-e.position.y;return!(r<0)&&!(s<0)&&!(s>=e.shape.length)&&!(r>=e.shape[0].length)&&1===e.shape[s][r]}function d(e,t,l,r,s){for(let a=0;a<t.shape.length;a++)for(let o=0;o<t.shape[a].length;o++)if(t.shape[a][o]){let i=t.position.x+o-l,n=t.position.y+a-r;i>=0&&i<e[0].length&&n>=0&&n<e.length&&("SET"===s?e[n][i]=1:"OR"===s?e[n][i]|=1:"XOR"===s?e[n][i]^=1:"ZERO"===s&&(e[n][i]=0))}}function c(e,t,l){let r=e.find(e=>e.id===l);if(!r||!r.symbols)return[];let s=[];for(let e=0;e<r.height;e++)for(let l=0;l<r.width;l++){let a=r.x+l,o=r.y+e,i=!1;for(let e of t)if(a>=e.position.x&&a<e.position.x+e.shape[0].length&&o>=e.position.y&&o<e.position.y+e.shape.length&&1===e.shape[o-e.position.y][a-e.position.x]){i=!0;break}if(!i){let t=r.symbols[e][l];t&&""!==t.trim()&&s.push({symbol:t,x:a,y:o})}}return s}function p(e,t,l){return c(e,t,l).map(e=>e.symbol)}function x(e,t){let l=e.find(e=>e.id===t);if(!l||!l.symbols)return[];let r=[];for(let e=0;e<l.height;e++)for(let t=0;t<l.width;t++){let s=l.symbols[e][t];s&&""!==s.trim()&&r.push({symbol:s,x:l.x+t,y:l.y+e})}return r}function h(e,t,l){let r=new Set(p(e,t,"allowed-region")),s=new Set(p(e,t,"disallowed-region")),a=x(e,"main-region"),o=new Set,i=[];for(let e of a){let l=!1;for(let r of t)if(e.x>=r.position.x&&e.x<r.position.x+r.shape[0].length&&e.y>=r.position.y&&e.y<r.position.y+r.shape.length&&1===r.shape[e.y-r.position.y][e.x-r.position.x]){l=!0;break}!l&&s.has(e.symbol)&&(o.add(e.symbol),i.push({x:e.x,y:e.y}))}let n=g(e,t,"allowed-region",r,!0),d=g(e,t,"disallowed-region",s,!1),c=function(e,t){let l=x(e,"main-region"),r=x(e,"allowed-region"),s=new Map;for(let e of r)s.set(e.symbol,(s.get(e.symbol)||0)+1);let a=new Map;for(let e of l){let l=!1;for(let r of t)if(e.x>=r.position.x&&e.x<r.position.x+r.shape[0].length&&e.y>=r.position.y&&e.y<r.position.y+r.shape.length&&1===r.shape[e.y-r.position.y][e.x-r.position.x]){l=!0;break}l&&a.set(e.symbol,(a.get(e.symbol)||0)+1)}let o=0;for(let e of new Set([...s.keys(),...a.keys()]))o+=(a.get(e)||0)*(s.get(e)||0);return o}(e,t),h=void 0!==l&&l>0&&c>l;return console.log("Covered Allowed Score:",c,"Limit:",l,"Exceeded:",h),{isWin:0===i.length&&!h,violations:Array.from(o),violatingCells:i,allowedStats:n,disallowedStats:d,coveredAllowedScore:c,coveredAllowedLimit:l,exceededLimit:h}}function g(e,t,l,r,s){let a=x(e,l),o=new Map;for(let e of a)o.set(e.symbol,(o.get(e.symbol)||0)+1);let i=x(e,"main-region"),n=c(e,t,"main-region"),d=[];for(let e of r){let t=i.filter(t=>t.symbol===e).length,l=n.filter(t=>t.symbol===e).length,r=t-l,a=s?r:l,c=o.get(e)||0;d.push({emoji:e,countInMain:a,totalInRegion:c})}return d.sort((e,t)=>e.emoji.localeCompare(t.emoji))}var m=e.i(63948),f=e.i(67784);let b=(0,f.default)("trophy",[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]]);var y=e.i(55995);let u=({isOpen:e,score:l,hasNextLevel:r,onNextLevel:s,onReplay:a,onBackToLevels:o,onClose:i})=>e?(0,t.jsxs)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),(0,t.jsxs)("div",{className:"relative z-10 bg-[var(--panel-bg)] border-8 border-[var(--panel-border)] shadow-[12px_12px_0_0_rgba(0,0,0,1)] p-8 max-w-md",children:[(0,t.jsx)("button",{onClick:i,className:"absolute -top-4 -right-4 p-2 bg-red-500 hover:bg-red-600 border-4 border-red-700 shadow-[4px_4px_0_0_rgba(0,0,0,0.3)] transition-colors","aria-label":"Close",children:(0,t.jsx)(y.X,{size:20,className:"text-white",strokeWidth:3})}),(0,t.jsx)("div",{className:"flex justify-center mb-6",children:(0,t.jsx)("div",{className:"bg-yellow-400 border-4 border-yellow-600 p-4 shadow-[4px_4px_0_0_rgba(0,0,0,0.3)]",children:(0,t.jsx)(b,{size:48,className:"text-yellow-800"})})}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-[var(--panel-text)] uppercase",style:{fontFamily:"var(--font-pixel)"},children:"Level Complete!"}),(0,t.jsxs)("div",{className:"bg-green-100 border-4 border-green-600 p-4 mb-6 text-center",children:[(0,t.jsx)("p",{className:"text-xs uppercase text-green-800 mb-2 font-bold",children:"Final Score"}),(0,t.jsx)("p",{className:"text-4xl font-bold text-green-800",children:l})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[r?(0,t.jsx)("button",{onClick:s,className:"flex items-center justify-center gap-2 px-6 py-4 bg-blue-600 text-white hover:bg-blue-700 border-b-4 border-blue-800 active:border-b-0 active:translate-y-1 font-bold text-sm uppercase shadow-md transition-all",children:"Next Level"}):(0,t.jsx)("div",{className:"px-6 py-4 bg-yellow-100 border-4 border-yellow-500 text-center",children:(0,t.jsx)("p",{className:"text-xs font-bold text-yellow-800 uppercase",children:"ðŸŽ‰ All Levels Complete! ðŸŽ‰"})}),(0,t.jsx)("button",{onClick:a,className:"flex items-center justify-center gap-2 px-6 py-4 bg-gray-200 text-gray-900 hover:bg-gray-300 border-b-4 border-gray-400 active:border-b-0 active:translate-y-1 font-bold text-sm uppercase shadow-md transition-all",children:"Replay Level"}),(0,t.jsx)("button",{onClick:o,className:"flex items-center justify-center gap-2 px-6 py-4 bg-gray-800 text-white hover:bg-gray-700 border-b-4 border-black active:border-b-0 active:translate-y-1 font-bold text-sm uppercase shadow-md transition-all",children:"Back to Levels"})]})]})]}):null,v=(0,f.default)("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),w=(0,f.default)("undo-2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]);var j=e.i(98952);let L=(0,f.default)("rotate-cw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),N=(0,f.default)("flip-horizontal",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h3",key:"1i73f7"}],["path",{d:"M16 3h3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-3",key:"saxlbk"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 14v2",key:"8jcxud"}],["path",{d:"M12 8v2",key:"1woqiv"}],["path",{d:"M12 2v2",key:"tus03m"}]]),S=({level:e,onNextLevel:r,onReplay:n,onBackToLevels:c,onLevelComplete:p,hasNextLevel:g,highScore:f})=>{let y,S,k=(0,l.useRef)(null),[E,M]=(0,l.useState)(ee(e.initialPieces)),[_,C]=(0,l.useState)([]),[A,R]=(0,l.useState)(0),[I,O]=(0,l.useState)(null),[z,D]=(0,l.useState)(!1),[T,$]=(0,l.useState)({isWin:!1,violations:[],violatingCells:[],allowedStats:[],disallowedStats:[],coveredAllowedScore:0,coveredAllowedLimit:e.coveredAllowedSymbolLimit,exceededLimit:!1}),{regions:P,symbolMap:F,gridCells:W}=function(e){let{grid:t,mainSymbols:l,allowedSymbols:r,disallowedSymbols:s,width:a,height:o}=e,i=t.map(e=>e.split("")),n=new Map,d=new Map,c=[...l.replace(/[\n\r]/g,"")],p=[...r.replace(/[\n\r]/g,"")],x=[...s.replace(/[\n\r]/g,"")],h=0,g=0,m=0;for(let e=0;e<o;e++)for(let t=0;t<a;t++){let l=i[e]?.[t]||".";if("M"===l){let l=c[h]||"";n.set(`${t},${e}`,l),h++,d.has("MAIN")||d.set("MAIN",{cells:[],type:"MAIN"}),d.get("MAIN").cells.push({x:t,y:e})}else if("A"===l||"a"===l){let l=p[g]||"";n.set(`${t},${e}`,l),g++,d.has("ALLOWED")||d.set("ALLOWED",{cells:[],type:"ALLOWED"}),d.get("ALLOWED").cells.push({x:t,y:e})}else if("D"===l||"d"===l){let l=x[m]||"";n.set(`${t},${e}`,l),m++,d.has("DISALLOWED")||d.set("DISALLOWED",{cells:[],type:"DISALLOWED"}),d.get("DISALLOWED").cells.push({x:t,y:e})}else"I"===l&&(d.has("INVENTORY")||d.set("INVENTORY",{cells:[],type:"INVENTORY"}),d.get("INVENTORY").cells.push({x:t,y:e}))}let f=[];return d.forEach((e,t)=>{let l;if(0===e.cells.length)return;let r=e.cells.map(e=>e.x),s=e.cells.map(e=>e.y),a=Math.min(...r),o=Math.min(...s),i=Math.max(...r)-a+1,d=Math.max(...s)-o+1;("MAIN"===e.type||"ALLOWED"===e.type||"DISALLOWED"===e.type)&&(l=Array.from({length:d},()=>Array(i).fill("")),e.cells.forEach(({x:e,y:t})=>{let r=e-a;l[t-o][r]=n.get(`${e},${t}`)||""})),f.push({id:`${e.type.toLowerCase()}-region`,type:e.type,x:a,y:o,width:i,height:d,symbols:l})}),{regions:f,symbolMap:n,gridCells:i}}(e);(0,l.useEffect)(()=>{if(T.isWin&&null===I){let e=100-T.coveredAllowedScore;O(e),D(!0),p&&p(e)}},[T.isWin,T.coveredAllowedScore,I,P,p]);let[V,B]=(0,l.useState)(null),[U,K]=(0,l.useState)(null),[Y,q]=(0,l.useState)(0),[H,X]=(0,l.useState)(!1),[J,Z]=(0,l.useState)({x:0,y:0}),[G,Q]=(0,l.useState)({x:0,y:0});function ee(e){return e.map(e=>({...e,id:e.id||crypto.randomUUID()}))}let et=(0,l.useCallback)(()=>{if(!U)return null;let e=U;H&&(e=e.map(e=>[...e].reverse()));let t=(Y%360+360)%360,l=t/90;for(let t=0;t<l;t++)e=function(e){if(0===e.length)return[];let t=e.length,l=e[0].length,r=Array.from({length:l},()=>Array(t).fill(0));for(let s=0;s<t;s++)for(let a=0;a<l;a++)r[a][t-1-s]=e[s][a];return r}(e);let r=0,s=0;if(90===t||270===t){let e=U[0].length,t=U.length;r=(e-t)/2*40,s=(t-e)/2*40}return{finalShape:e,gridX:Math.round((G.x+r)/40),gridY:Math.round((G.y+s)/40)}},[U,Y,H,G.x,G.y]);(0,l.useEffect)(()=>{let e=e=>{if("KeyZ"===e.code){e.preventDefault(),el();return}if("KeyC"==e.code){e.preventDefault(),er();return}V&&U&&("KeyR"===e.code?(e.preventDefault(),q(e=>e+90)):"KeyF"===e.code&&(e.preventDefault(),X(e=>!e)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[V,U,_]);let el=()=>{if(0===_.length)return;B(null),K(null),q(0),X(!1);let t=[..._],l=t.pop();C(t),l&&(M(l),$(h(P,l,e.coveredAllowedSymbolLimit)),R(e=>e+1))},er=()=>{if(confirm("Reset Level?")){let t=ee(e.initialPieces);M(t),C([]),$(h(P,t,e.coveredAllowedSymbolLimit)),R(e=>e+1),O(null),D(!1)}};(0,l.useEffect)(()=>{$(h(P,E,e.coveredAllowedSymbolLimit))},[]);let[es,ea]=(0,l.useState)([]),eo=(0,l.useRef)([]);return(0,l.useEffect)(()=>{let e=eo.current,t=T.violatingCells,l=e.filter(e=>!t.some(t=>t.x===e.x&&t.y===e.y));if(l.length>0){let e=l.map(e=>({...e,id:Math.random().toString(36).substr(2,9)}));ea(t=>[...t,...e]),setTimeout(()=>{ea(t=>t.filter(t=>!e.some(e=>e.id===t.id)))},1e3)}eo.current=t},[T.violatingCells]),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4 p-8 select-none relative",children:[(0,t.jsx)("style",{dangerouslySetInnerHTML:{__html:`
                @keyframes pulsate-red {
                    0% { border-color: rgba(239, 68, 68, 0.3); box-shadow: inset 0 0 2px rgba(239, 68, 68, 0.1); }
                    50% { border-color: rgba(239, 68, 68, 0.7); box-shadow: inset 0 0 8px rgba(239, 68, 68, 0.3); }
                    100% { border-color: rgba(239, 68, 68, 0.3); box-shadow: inset 0 0 2px rgba(239, 68, 68, 0.1); }
                }
                @keyframes pulsate-blue {
                    0% { border-color: rgba(24, 216, 241, 0.8); box-shadow: inset 0 0 4px rgba(24, 216, 241, 0.2), 0 0 4px rgba(24, 216, 241, 0.2); }
                    50% { border-color: rgba(24, 216, 241, 1); box-shadow: inset 0 0 16px rgba(24, 216, 241, 0.4), 0 0 12px rgba(24, 216, 241, 0.6); }
                    100% { border-color: rgba(24, 216, 241, 0.8); box-shadow: inset 0 0 4px rgba(24, 216, 241, 0.2), 0 0 4px rgba(24, 216, 241, 0.2); }
                }
                @keyframes ripple-red {
                    0% { transform: scale(1); opacity: 0.8; }
                    100% { transform: scale(12); opacity: 0; }
                }
                @keyframes ripple-blue {
                    0% { transform: scale(1); opacity: 0.8; }
                    100% { transform: scale(12); opacity: 0; }
                }
                @keyframes ripple-green {
                    0% { transform: scale(1); opacity: 0.8; }
                    100% { transform: scale(12); opacity: 0; }
                }
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
            `}}),(0,t.jsxs)("div",{className:`fixed top-4 right-4 p-4 border-4 shadow-[4px_4px_0_0_rgba(0,0,0,0.2)] transition-all z-50 ${T.isWin?"bg-green-100 border-green-600":"bg-[var(--panel-bg)] border-[var(--panel-border)]"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[T.isWin?(0,t.jsx)(b,{className:"text-green-600",size:24}):(0,t.jsx)(j.AlertTriangle,{className:"text-amber-500",size:24}),(0,t.jsx)("h3",{className:`font-bold text-sm ${T.isWin?"text-green-800":"text-[var(--panel-text)]"}`,style:{textTransform:"uppercase"},children:T.isWin?"Level Cleared!":"Status"})]}),T.allowedStats.length>0&&(0,t.jsxs)("div",{className:"text-xs mb-3",children:[(0,t.jsx)("p",{className:"font-bold mb-1 text-green-700",children:"COVERED ALLOWED:"}),(0,t.jsx)("div",{className:"flex flex-col gap-1",children:T.allowedStats.map(e=>(0,t.jsxs)("div",{className:"px-2 py-1 bg-green-50 border-2 border-green-300 font-bold flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-base font-emoji",children:e.emoji}),(0,t.jsxs)("span",{className:"text-gray-600",children:[e.countInMain," Ã— ",e.totalInRegion]})]},e.emoji))}),void 0!==T.coveredAllowedLimit&&(0,t.jsx)("div",{className:`mt-2 px-2 py-1 border-2 font-bold ${T.exceededLimit?"bg-red-50 border-red-500 text-red-700":"bg-green-50 border-green-300 text-green-700"}`,children:(0,t.jsxs)("span",{className:"text-xs",children:["TOTAL: ",T.coveredAllowedScore," / ",T.coveredAllowedLimit]})}),(0,t.jsx)("div",{className:"mt-2 px-2 py-1 bg-blue-50 border-2 border-blue-300 font-bold text-blue-700",children:(0,t.jsxs)("span",{className:"text-xs",children:["CURRENT SCORE: ",100-T.coveredAllowedScore]})}),void 0!==f&&f>0&&(0,t.jsx)("div",{className:"mt-2 px-2 py-1 bg-yellow-50 border-2 border-yellow-300 font-bold text-yellow-700",children:(0,t.jsxs)("span",{className:"text-xs",children:["PERSONAL BEST: ",f]})})]}),T.disallowedStats.length>0&&(0,t.jsxs)("div",{className:"text-xs mb-3",children:[(0,t.jsx)("p",{className:"font-bold mb-1 text-red-700",children:"DISALLOWED:"}),(0,t.jsx)("div",{className:"flex flex-col gap-1",children:T.disallowedStats.map(e=>(0,t.jsxs)("div",{className:"px-2 py-1 bg-red-50 border-2 border-red-300 font-bold flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-base font-emoji",children:e.emoji}),(0,t.jsx)("span",{className:"text-gray-600",children:e.countInMain})]},e.emoji))})]})]}),(0,t.jsxs)("div",{className:"fixed bottom-4 left-1/2 -translate-x-1/2 z-40 flex gap-4",children:[(0,t.jsxs)("button",{onClick:el,disabled:0===_.length,className:"flex items-center gap-2 px-4 py-3 bg-gray-800 text-white hover:bg-gray-700 disabled:opacity-50 border-b-4 border-gray-950 active:border-b-0 active:translate-y-1 font-bold text-xs uppercase shadow-md transition-all",children:[(0,t.jsx)(w,{size:16})," Undo (Z)"]}),(0,t.jsxs)("button",{onClick:er,className:"flex items-center gap-2 px-4 py-3 bg-gray-200 text-gray-900 hover:bg-gray-300 border-b-4 border-gray-400 active:border-b-0 active:translate-y-1 font-bold text-xs uppercase shadow-md transition-all",children:[(0,t.jsx)(v,{size:16})," Reset (C)"]})]}),(0,t.jsxs)("div",{ref:k,className:"relative bg-[var(--panel-bg)] shadow-[8px_8px_0_0_rgba(0,0,0,0.2)] border-4 border-[var(--panel-border)]",style:{width:40*e.width,height:40*e.height,boxSizing:"content-box"},onPointerMove:e=>{if(!V||!k.current)return;e.preventDefault();let t=k.current.getBoundingClientRect(),l=e.clientX-t.left,r=e.clientY-t.top;Q({x:l-J.x,y:r-J.y})},onPointerUp:t=>{if(!V)return;t.preventDefault();let l=E.find(e=>e.id===V);if(!l||!U){B(null),K(null);return}let r=et();if(!r)return;let{finalShape:n,gridX:c,gridY:p}=r,x={...l,position:{x:c,y:p},shape:n},g=[...E];if(c<0||p<0||c+x.shape[0].length>e.width||p+x.shape.length>e.height){B(null),K(null),q(0),X(!1);return}let m=function(e,t,l){let r,n=t.type;if(l){for(let e=0;e<t.shape.length;e++)for(let r=0;r<t.shape[e].length;r++)if(1===t.shape[e][r]){let s=t.position.x+r,a=t.position.y+e;if(a>=0&&a<l.length&&s>=0&&s<l[a].length){let e=l[a][s];if("#"===e||"a"===e||"d"===e)return{success:!1,reason:"BLOCKED_CELL"}}}}if(e.filter(e=>(e.type===s.PieceType.BLOCKER||n===s.PieceType.BLOCKER)&&i(e,t)).length>0)return{success:!1,reason:"BLOCKER"};if(n===s.PieceType.XOR)return function(e,t){let l=e.filter(e=>e.type!==s.PieceType.BLOCKER&&i(e,t));if(0===l.length)return{success:!0,newPieces:[...e,t]};let r=new Set(l.map(e=>e.id)),n=e.filter(e=>!r.has(e.id)),c=[];for(let e of l){let l=Math.min(t.position.x,e.position.x),r=Math.min(t.position.y,e.position.y),s=Math.max(t.position.x+t.shape[0].length,e.position.x+e.shape[0].length),i=Math.max(t.position.y+t.shape.length,e.position.y+e.shape.length),n=s-l,p=i-r,x=a(n,p);d(x,e,l,r,"SET"),d(x,t,l,r,"ZERO");let h=a(n,p);for(let s of(d(h,t,l,r,"SET"),d(h,e,l,r,"ZERO"),[...o(x,{x:l,y:r,width:n,height:p}),...o(h,{x:l,y:r,width:n,height:p})]))c.push({id:crypto.randomUUID(),type:e.type,position:s.position,shape:s.shape,color:e.color})}return{success:!0,newPieces:[...n,...c]}}(e,t);let c=function(e,t){let l=[],r=[e],s=new Set([e.id]);for(;r.length>0;){let e=r.shift();for(let a of t)!s.has(a.id)&&i(e,a)&&(s.add(a.id),l.push(a),r.push(a))}return l}(t,e.filter(e=>e.type!==s.PieceType.BLOCKER)),p=new Set(c.map(e=>e.id)),x=c.length>0?c[0].type:n,h=c.length>0?c[0].color:t.color,g=e.filter(e=>!p.has(e.id)),m=1/0,f=1/0,b=-1/0,y=-1/0,u=[...c,t];for(let e of u)m=Math.min(m,e.position.x),f=Math.min(f,e.position.y),b=Math.max(b,e.position.x+e.shape[0].length),y=Math.max(y,e.position.y+e.shape.length);let v=b-m,w=y-f;if(t.type===s.PieceType.INTERSECT){let e=a(v,w);d(e,u[0],m,f,"SET");for(let t=1;t<u.length;t++){let l=a(v,w);d(l,u[t],m,f,"SET");for(let t=0;t<w;t++)for(let r=0;r<v;r++)e[t][r]&=l[t][r]}let t=!0;e:for(let l=0;l<w;l++)for(let r=0;r<v;r++)if(1===e[l][r]){t=!1;break e}if(t)for(let e of(r=a(v,w),u))d(r,e,m,f,"OR");else r=e}else for(let e of(r=a(v,w),u))d(r,e,m,f,"OR");let j=o(r,{x:m,y:f,width:v,height:w});return{success:!0,newPieces:[...g,...j.map((e,l)=>({id:0===l&&1===j.length?t.id:crypto.randomUUID(),type:x,position:e.position,shape:e.shape,color:h}))]}}(E.filter(e=>e.id!==V),x,e.grid),f=JSON.stringify(l.shape)===JSON.stringify(x.shape),b=l.position.x!==c||l.position.y!==p||!f;m.success&&b&&(C(e=>[...e,g]),M(m.newPieces),R(e=>e+1),$(h(P,m.newPieces,e.coveredAllowedSymbolLimit))),B(null),K(null),q(0),X(!1)},children:[(()=>{let l=[];for(let r=0;r<=e.width;r++)l.push((0,t.jsx)("div",{style:{position:"absolute",left:40*r,top:0,bottom:0,borderLeft:"1px solid var(--grid-line)"}},`v-${r}`));for(let r=0;r<=e.height;r++)l.push((0,t.jsx)("div",{style:{position:"absolute",top:40*r,left:0,right:0,borderTop:"1px solid var(--grid-line)"}},`h-${r}`));return l})(),(()=>{let l=[];for(let r=0;r<e.height;r++)for(let s=0;s<e.width;s++){let e=W[r]?.[s]||".",a=F.get(`${s},${r}`)||"",o="transparent",i="",n="none";"M"===e?(o="var(--color-region-sky)",n="2px solid rgba(0,0,0,0.1)"):"A"===e?(o="var(--color-region-grass)",n="2px solid rgba(0,0,0,0.1)"):"D"===e?(o="var(--color-region-lava)",n="2px solid rgba(0,0,0,0.1)"):"I"===e?(o="var(--color-region-wood)",n="2px solid rgba(0,0,0,0.1)"):"#"===e?(o="var(--color-wall)",i="repeating-linear-gradient(45deg, var(--color-wall-accent) 0, var(--color-wall-accent) 4px, var(--color-wall) 4px, var(--color-wall) 8px)"):"a"===e?(o="var(--color-region-grass)",i="repeating-linear-gradient(45deg, rgba(0,0,0,0.05) 0, rgba(0,0,0,0.05) 2px, transparent 2px, transparent 10px)",n="2px solid rgba(0,0,0,0.1)"):"d"===e&&(o="var(--color-region-lava)",i="repeating-linear-gradient(45deg, rgba(0,0,0,0.05) 0, rgba(0,0,0,0.05) 2px, transparent 2px, transparent 10px)",n="2px solid rgba(0,0,0,0.1)");let d=new Set(T.allowedStats.map(e=>e.emoji)).has(a),c=!1;for(let e of E)if(s>=e.position.x&&s<e.position.x+e.shape[0].length&&r>=e.position.y&&r<e.position.y+e.shape.length&&1===e.shape[r-e.position.y][s-e.position.x]){c=!0;break}let p=d&&c,x=T.violatingCells.some(e=>e.x===s&&e.y===r),h=es.some(e=>e.x===s&&e.y===r);"."!==e&&l.push((0,t.jsxs)("div",{style:{position:"absolute",left:40*s,top:40*r,width:40,height:40,backgroundColor:o,backgroundImage:i,border:n,display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"var(--font-emoji), var(--font-pixel)",zIndex:x||p?6:5*("#"===e),boxSizing:"border-box",boxShadow:"#"===e?"inset 2px 2px 0 rgba(255,255,255,0.1), inset -2px -2px 0 rgba(0,0,0,0.3)":"none",overflow:"hidden"},children:[x&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-10",children:(0,t.jsx)("div",{className:"w-2 h-2 rounded-full animate-ripple",style:{background:"radial-gradient(circle, transparent 20%, rgba(239,68,68,0.9) 40%, rgba(239,68,68,0) 70%)",animation:"ripple-red 1s ease-out 1 forwards"}})},`ripple-red-${A}`),(0,t.jsx)("div",{className:"absolute inset-0 border-2 border-red-500/60 pointer-events-none z-10",style:{opacity:0,animation:"fadeIn 0.5s ease-out forwards, pulsate-red 2s infinite 0.5s"}})]}),p&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-10",children:(0,t.jsx)("div",{className:"w-2 h-2 rounded-full animate-ripple",style:{background:"radial-gradient(circle, transparent 20%, rgba(24, 216, 241, 0.9) 40%, rgba(24, 216, 241, 0) 70%)",animation:"ripple-blue 1s ease-out 1 forwards"}})},`ripple-blue-${A}`),(0,t.jsx)("div",{className:"absolute inset-0 border-2 pointer-events-none z-10",style:{borderColor:"rgba(24, 216, 241, 0.6)",opacity:0,animation:"fadeIn 0.5s ease-out forwards, pulsate-blue 2s infinite 0.5s"}})]}),(0,t.jsx)("span",{className:"relative z-0",children:a}),h&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-10",children:(0,t.jsx)("div",{className:"w-2 h-2 rounded-full animate-ripple",style:{background:"radial-gradient(circle, rgba(74,222,128,0.9) 0%, rgba(74,222,128,0) 70%)",animation:"ripple-green 0.6s ease-out 1 forwards"}})})]},`cell-${r}-${s}`))}return l})(),(()=>{let e=et();if(!V||!e)return null;let l=E.find(e=>e.id===V);return l?(0,t.jsx)("div",{style:{pointerEvents:"none"},children:(0,t.jsx)(m.PieceRenderer,{piece:{...l,shape:e.finalShape,position:{x:e.gridX,y:e.gridY}},cellSize:40,style:{opacity:.4,zIndex:5,transition:"none",filter:"grayscale(1) brightness(1.5)"}})}):null})(),(y=new Set(T.allowedStats.map(e=>e.emoji)),S=x(P,"main-region").filter(e=>y.has(e.symbol)).map(e=>({x:e.x,y:e.y})),E.map(e=>{let l=e.id===V;return(0,t.jsx)(m.PieceRenderer,{piece:l?{...e,shape:U||e.shape}:e,cellSize:40,isDragging:l,dragPosition:l?G:void 0,dragRotation:l?Y:0,dragFlipped:!!l&&H,violatingCells:T.violatingCells,allowedCells:l?[]:S,moveId:A,onPointerDown:l?void 0:t=>((e,t)=>{if(e.stopPropagation(),e.preventDefault(),!k.current)return;let l=k.current.getBoundingClientRect(),r=e.clientX-l.left,s=e.clientY-l.top,a=40*t.position.x,o=40*t.position.y;B(t.id),K(t.shape),q(0),X(!1),Z({x:r-a,y:s-o}),Q({x:a,y:o}),e.target.setPointerCapture(e.pointerId)})(t,e)},e.id)}))]}),(0,t.jsxs)("div",{className:`mt-4 flex items-center gap-2 px-4 py-3 bg-[var(--panel-bg)] text-[var(--panel-text)] border-2 border-[var(--panel-border)] border-b-4 text-xs font-bold shadow-md transition-opacity ${V?"opacity-100":"opacity-0 pointer-events-none"}`,children:[(0,t.jsx)(L,{size:14})," ",(0,t.jsx)("span",{children:"Rotate: R"}),(0,t.jsx)("span",{className:"w-0.5 h-4 bg-gray-300 mx-2"}),(0,t.jsx)(N,{size:14})," ",(0,t.jsx)("span",{children:"Flip: F"})]}),(0,t.jsx)(u,{isOpen:z,score:I||0,hasNextLevel:g,onNextLevel:r,onReplay:n,onBackToLevels:c,onClose:()=>D(!1)})]})},k=(0,f.default)("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]),E=(0,f.default)("sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);function M(){let[e,r]=(0,l.useState)(!1),[s,a]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{r(!0);let e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;"dark"===e||!e&&t?(a(!0),document.documentElement.classList.add("dark")):(a(!1),document.documentElement.classList.remove("dark"))},[]),e)?(0,t.jsx)("button",{onClick:()=>{s?(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"),a(!1)):(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark"),a(!0))},className:`
                flex items-center gap-2 px-4 py-3 
                border-b-4 active:border-b-0 active:translate-y-1 
                font-bold text-xs uppercase shadow-md transition-all
                ${s?"bg-gray-800 text-white hover:bg-gray-700 border-gray-950":"bg-gray-200 text-gray-900 hover:bg-gray-300 border-gray-400"}
            `,"aria-label":"Toggle theme",children:s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(k,{size:16})," ",(0,t.jsx)("span",{className:"hidden sm:inline",children:"Dark"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E,{size:16})," ",(0,t.jsx)("span",{className:"hidden sm:inline",children:"Light"})]})}):(0,t.jsxs)("button",{className:"flex items-center gap-2 px-4 py-3 border-b-4 border-gray-400 dark:border-gray-950 bg-gray-200 dark:bg-gray-800 opacity-50 cursor-default font-bold text-xs uppercase shadow-md text-gray-900 dark:text-white",children:[(0,t.jsx)(E,{size:16,className:"text-gray-900 dark:text-white"})," ",(0,t.jsx)("span",{className:"hidden sm:inline",children:"Light"})]})}var _=e.i(63641),C=e.i(78613);let A=(0,f.default)("lock-open",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),R=(0,f.default)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),I="masqagrid_progress";function O(){let[e,s]=(0,l.useState)(null),[a,o]=(0,l.useState)(0),[i,n]=(0,l.useState)({unlockedLevels:[_.LEVELS[0].id],completedLevels:[],highScores:{}}),[d,c]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=localStorage.getItem(I);if(e)try{let t=JSON.parse(e);n(e=>({...e,...t,highScores:t.highScores||{}}))}catch(e){console.error("Failed to parse saved progress:",e)}c(!0)},[]),(0,l.useEffect)(()=>{d&&localStorage.setItem(I,JSON.stringify(i))},[i,d]);let p=e?(0,_.getLevelById)(e):null,x=p||_.DEFAULT_LEVEL.level,h=e?_.LEVELS.findIndex(t=>t.id===e):-1,g=h<_.LEVELS.length-1,m=()=>{s(null),o(0)};return e?(0,t.jsxs)("main",{className:"min-h-screen flex flex-col items-center justify-center p-4 bg-[var(--background)] transition-colors duration-300",children:[(0,t.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:(0,t.jsx)(M,{})}),(0,t.jsxs)("button",{onClick:m,className:"fixed top-4 left-4 z-50 flex items-center gap-2 px-4 py-3 bg-[var(--panel-bg)] border-4 border-[var(--panel-border)] shadow-[4px_4px_0_0_rgba(0,0,0,0.2)] hover:shadow-[6px_6px_0_0_rgba(0,0,0,0.3)] active:shadow-none active:translate-x-1 active:translate-y-1 transition-all text-[var(--panel-text)] font-bold text-xs uppercase",style:{fontFamily:"var(--font-pixel)"},children:[(0,t.jsx)(C.ArrowLeft,{size:16}),"Levels"]}),(0,t.jsx)("div",{className:"text-center mb-6",children:(0,t.jsx)("h1",{className:"text-4xl font-bold text-[var(--foreground)] mb-2",style:{fontFamily:"var(--font-pixel)"},children:p?.name||"Masqagrid"})}),(0,t.jsx)(S,{level:x,onNextLevel:()=>{g&&s(_.LEVELS[h+1].id)},onReplay:()=>{o(e=>e+1)},onBackToLevels:m,onLevelComplete:e?t=>{n(l=>{let r={...l};r.completedLevels.includes(e)||r.completedLevels.push(e),r.highScores||(r.highScores={}),t>(r.highScores[e]||-1)&&(r.highScores[e]=t);let s=_.LEVELS.findIndex(t=>t.id===e);if(s<_.LEVELS.length-1){let e=_.LEVELS[s+1].id;r.unlockedLevels.includes(e)||r.unlockedLevels.push(e)}return r})}:void 0,hasNextLevel:g,highScore:e?i.highScores[e]:void 0},`${e}-${a}`)]}):(0,t.jsxs)("main",{className:"min-h-screen flex flex-col items-center justify-center p-8 bg-[var(--background)] transition-colors duration-300",children:[(0,t.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:(0,t.jsx)(M,{})}),(0,t.jsxs)("div",{className:"fixed top-4 right-4 z-50 flex flex-col gap-2 items-end",children:[(0,t.jsxs)(r.default,{href:"/about",className:"flex items-center gap-2 px-3 py-2 bg-[var(--panel-bg)] border-2 border-[var(--panel-border)] shadow-[2px_2px_0_0_rgba(0,0,0,0.2)] hover:shadow-[3px_3px_0_0_rgba(0,0,0,0.3)] active:shadow-none active:translate-x-1 active:translate-y-1 transition-all text-[var(--panel-text)] font-bold text-xs",style:{fontFamily:"var(--font-pixel)"},children:[(0,t.jsx)(R,{size:14}),"ABOUT US"]}),(0,t.jsxs)("button",{onClick:()=>{n({unlockedLevels:_.LEVELS.map(e=>e.id),completedLevels:[],highScores:i.highScores||{}})},className:"flex items-center gap-2 px-3 py-2 bg-gray-300 border-2 border-gray-400 shadow-[2px_2px_0_0_rgba(0,0,0,0.2)] hover:shadow-[3px_3px_0_0_rgba(0,0,0,0.3)] active:shadow-none active:translate-x-1 active:translate-y-1 transition-all text-white font-bold text-xs",style:{fontFamily:"var(--font-pixel)"},children:[(0,t.jsx)(A,{size:14}),"UNLOCK ALL"]}),(0,t.jsxs)("button",{onClick:()=>{if(confirm("Are you sure you want to reset all progress? This will lock all levels except the first one.")){let e={unlockedLevels:[_.LEVELS[0].id],completedLevels:[],highScores:{}};n(e),localStorage.setItem(I,JSON.stringify(e))}},className:"flex items-center gap-2 px-3 py-2 bg-red-400 border-2 border-red-600 shadow-[2px_2px_0_0_rgba(0,0,0,0.2)] hover:shadow-[3px_3px_0_0_rgba(0,0,0,0.3)] active:shadow-none active:translate-x-1 active:translate-y-1 transition-all text-white font-bold text-xs",style:{fontFamily:"var(--font-pixel)"},children:[(0,t.jsx)(v,{size:14}),"RESET"]})]}),(0,t.jsxs)("div",{className:"text-center mb-12",children:[(0,t.jsx)("h1",{className:"text-6xl font-bold text-[var(--foreground)] mb-4 tracking-tight",style:{fontFamily:"var(--font-pixel)"},children:"MASQAGRID"}),(0,t.jsx)("p",{className:"text-lg text-[var(--foreground)] opacity-70 max-w-md mx-auto"})]}),(0,t.jsxs)("div",{className:"max-w-4xl w-full",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-[var(--foreground)] mb-6 text-center uppercase",style:{fontFamily:"var(--font-pixel)"},children:"Select Level"}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:_.LEVELS.map((e,l)=>{let r=i.unlockedLevels.includes(e.id),a=i.completedLevels.includes(e.id);return(0,t.jsxs)("button",{onClick:()=>r&&void(s(e.id),o(0)),disabled:!r,className:`group relative border-4 shadow-[4px_4px_0_0_rgba(0,0,0,0.2)] transition-all p-5 flex flex-col items-center gap-1 ${r?"bg-[var(--panel-bg)] border-[var(--panel-border)] hover:shadow-[6px_6px_0_0_rgba(0,0,0,0.3)] active:shadow-none active:translate-x-1 active:translate-y-1 cursor-pointer":"bg-gray-300 border-gray-500 opacity-50 cursor-not-allowed"}`,children:[a&&(0,t.jsx)("div",{className:"absolute -top-2 -right-2 bg-green-500 border-2 border-green-700 rounded-full w-6 h-6 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-white text-xs font-bold",children:"âœ“"})}),(0,t.jsx)("div",{className:"text-2xl font-bold text-[var(--panel-text)]",style:{fontFamily:"var(--font-pixel)"},children:l+1}),(0,t.jsx)("div",{className:"h-8 flex items-center justify-center text-xs font-bold text-[var(--panel-text)] uppercase text-center leading-tight",style:{fontFamily:"var(--font-pixel)"},children:e.name}),(0,t.jsx)("div",{className:"h-6 flex items-center justify-center",children:a&&i.highScores?.[e.id]!==void 0?(0,t.jsxs)("div",{className:"px-2 py-0.5 bg-yellow-100 border-2 border-yellow-400 text-yellow-800 text-[10px] font-bold uppercase rounded-sm",children:["Best: ",i.highScores[e.id]]}):(0,t.jsx)("div",{className:"h-full"})})]},e.id)})})]})]})}e.s(["default",()=>O],31713)}]);